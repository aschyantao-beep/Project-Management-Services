# 🤖 AI聊天功能

## 功能概述

项目管理大师现已集成AI聊天功能，用户可以在前端界面直接配置API密钥，与AI助手进行智能对话，获取项目相关的建议和帮助。

## ✨ 主要特性

### 🔧 前端API密钥配置
- **可视化配置界面**: 在界面中直接输入和配置API密钥
- **多提供商支持**: 支持OpenRouter、OpenAI、Anthropic等主流AI服务
- **密钥安全存储**: API密钥在后端加密存储，前端不会暴露密钥
- **配置验证**: 提供API密钥有效性测试功能

### 💬 智能聊天功能
- **项目上下文感知**: AI助手能够了解当前项目信息，提供针对性建议
- **对话历史管理**: 支持保存和查看历史对话记录
- **多会话支持**: 可以同时管理多个对话会话
- **实时响应**: 支持流式响应，提供良好的用户体验

### 🛡️ 安全特性
- **密钥加密**: 使用Base64编码对API密钥进行基础加密
- **后端验证**: 所有AI请求都通过后端转发，保护API密钥安全
- **请求限制**: 可配置最大令牌数和温度参数，控制API使用

## 🚀 快速开始

### 1. 启动后端服务
```bash
cd backend
python run.py
```

### 2. 启动前端服务
```bash
cd frontend
npm run dev
```

### 3. 访问AI聊天功能
- 打开浏览器访问: http://localhost:3000
- 点击顶部导航栏的 "AI聊天测试"
- 或者在项目详情页面查看右侧的AI聊天面板

### 4. 配置AI服务
1. 点击"配置AI服务"按钮
2. 选择AI提供商（推荐使用OpenRouter）
3. 输入您的API密钥
4. 选择合适的模型
5. 点击"保存配置"

## 📋 API端点

### AI配置管理
- `GET /api/ai/config` - 获取当前AI配置
- `POST /api/ai/config` - 更新AI配置
- `POST /api/ai/test` - 测试AI配置

### 聊天功能
- `GET /api/ai/conversations` - 获取会话列表
- `POST /api/ai/conversations` - 创建新会话
- `GET /api/ai/conversations/{id}/messages` - 获取会话消息
- `POST /api/ai/conversations/{id}/messages` - 发送消息
- `GET /api/ai/models` - 获取可用模型列表

## 🔧 技术实现

### 后端架构
- **Flask框架**: 使用Python Flask构建RESTful API
- **SQLAlchemy ORM**: 数据库模型管理
- **AI服务层**: 封装多提供商AI调用逻辑
- **安全配置**: API密钥加密存储和验证

### 前端架构
- **Vue3 + TypeScript**: 现代化前端框架
- **Pinia状态管理**: 集中管理AI聊天状态
- **Element Plus**: 美观的UI组件库
- **组件化设计**: 可复用的AI聊天组件

### 数据库模型
- **AIConfig**: AI服务配置信息
- **ChatConversation**: 聊天会话记录
- **ChatMessage**: 聊天消息记录

## 📝 使用说明

### 获取API密钥

#### OpenRouter (推荐)
1. 访问 https://openrouter.ai/keys
2. 注册账号并登录
3. 创建新的API密钥
4. 复制密钥到配置界面

#### OpenAI
1. 访问 https://platform.openai.com/api-keys
2. 登录您的OpenAI账号
3. 创建新的API密钥
4. 复制密钥到配置界面

#### Anthropic
1. 访问 https://console.anthropic.com/
2. 注册账号并登录
3. 获取API密钥
4. 复制密钥到配置界面

### 使用建议

1. **模型选择**: 根据需求选择合适的模型
   - 快速响应: GPT-3.5 Turbo 或 Claude-3 Haiku
   - 复杂推理: GPT-4 或 Claude-3 Sonnet/Opus

2. **参数配置**:
   - 最大令牌数: 1000-2000（平衡响应速度和质量）
   - 温度: 0.7（平衡创造性和准确性）

3. **项目上下文**: 在项目详情页使用AI聊天时，AI会自动了解项目信息，提供更精准的建议

## 🔍 故障排除

### 常见问题

1. **API密钥无效**
   - 检查密钥是否正确复制
   - 确认账户是否有足够余额
   - 验证密钥权限是否足够

2. **AI无响应**
   - 检查网络连接
   - 查看浏览器控制台错误信息
   - 确认后端服务是否正常运行

3. **配置保存失败**
   - 检查API密钥格式
   - 确认选择了正确的提供商
   - 查看后端日志获取详细信息

### 调试方法
1. 打开浏览器开发者工具
2. 查看Network标签页的API请求
3. 检查Console标签页的错误信息
4. 查看后端服务日志

## 🔒 安全注意事项

1. **API密钥保护**: 不要将API密钥提交到代码仓库
2. **网络传输**: 使用HTTPS协议保护数据传输
3. **访问控制**: 在生产环境中实施适当的访问控制
4. **费用监控**: 定期监控API使用情况，避免意外费用

## 🚀 未来展望

- **多语言支持**: 支持更多AI提供商和模型
- **高级功能**: 文件上传、图片识别等功能
- **性能优化**: 缓存机制和响应速度优化
- **用户体验**: 更丰富的交互界面和动画效果

## 📞 支持

如遇到问题，请检查以下内容：
- 确保所有服务正常运行
- 查看浏览器控制台和服务器日志
- 验证API密钥和网络连接
- 参考项目文档和README文件